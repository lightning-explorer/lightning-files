<div class="content" [@fadeAnimation]="animationState" (dragover)="onMainDragOver($event)">
    <div *ngIf="currentDirectoryMetadata?.isAccessible; else isInaccessible" class="content">
        <app-inline-search-bar />

        <div *ngIf="files.length==0; else elseBlock" class="no-files">
            <app-folder-loader *ngIf="isLoading; else emptyLabel" />
            <ng-template #emptyLabel>
                <label><b>{{currentDirectory}}</b> is empty</label>
            </ng-template>
        </div>


        <ng-template #elseBlock>
            <cdk-virtual-scroll-viewport itemSize="32" style="height: 100%; width: 100%;">

                <div *cdkVirtualFor="let file of files; let i = index" class="item">
                    <app-file-result [file]="file"
                        [state]="states[i]"
                        [draggable]="true" 
                        (dragstart)="onFileDragStart($event, i, file)"
                        (dragover)="onFileDragOver($event, file)" 
                        (drop)="onFileDrop($event, file)"
                        (dragleave)="onFileDragLeave($event, file)"
                        (dragend)="onFileDragEnd($event,file)"
                        [selected]="selectedIndices.has(i)" 
                        (click)="onFileClick(i, $event)"
                        (dblclick)="onFileDoubleClick(file)" 
                        (contextmenu)="this.onFileRightClick(file, $event)" />
                </div>

            </cdk-virtual-scroll-viewport>
        </ng-template>

    </div>

    <ng-template #isInaccessible>
        <div class="no-files">
            <label>Unable to access <b>{{currentDirectory}}</b>. Permission denied</label>
        </div>
    </ng-template>
</div>



<!-- The below items are disconnected from the main component's html -->
<app-move-items-popup #moveItemsPopup />

<app-generic-err-popup #genericErrPopup/>

<div class="drag-preview" #dragPreview>
    <div *ngFor="let item of selectedItems | slice:0:5">
        {{item.Name}}
    </div>
    <div *ngIf="selectedItems.length > 5">
        ...and {{ selectedItems.length - 5 }} more
    </div>
</div>

<app-context-menu #contextMenu />